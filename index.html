<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="Style/style.css">
</head>
<body>
    <h1>Adaugă Produs</h1>

    <div>
        <h2>Categorii</h2>
        <input type="text" id="categoryName" placeholder="Introduceți numele categoriei">
        <button type="button" onclick="addCategory()">Adaugă categorie</button>
    </div>

    <div id="categoriesContainer">
        <!-- Categoriile vor fi adăugate aici -->
    </div>

    <div id="itemFormContainer" style="display: none;">
        <h2>Adaugă Produs în categoria <span id="selectedCategory"></span></h2>
        <form id="productForm">
            <label for="id">ID Produs:</label>
            <input type="text" id="id" required>

            <label for="name">Nume Produs:</label>
            <input type="text" id="name" required>

            <label for="price">Preț:</label>
            <input type="text" id="price" required>

            <label for="images">Imagini (separate prin virgule):</label>
            <input type="text" id="images" placeholder="images/Inele/ring22.jpg, images/Inele/ring2.jpg" required>

            <label for="description">Descriere:</label>
            <textarea id="description" required></textarea>

            <div class="optional">
                <label for="isTrending">Produsul este în trend:</label>
                <input type="checkbox" id="isTrending">

                <label for="old_price">Preț Veche:</label>
                <input type="text" id="old_price" placeholder="Ex: 1645.00 MDL">

                <label for="out_Of_stock">Este epuizat:</label>
                <input type="checkbox" id="out_Of_stock">

                <label for="isNew">Produs Nou:</label>
                <input type="checkbox" id="isNew">

                <label for="product_sizes">Dimensiuni disponibile (separate prin virgule):</label>
                <input type="text" id="product_sizes" placeholder="Ex: 15, 16, 17, 18, 19">
            </div>

            <button type="button" onclick="saveProduct()">Salvează Produs</button>
        </form>
    </div>

    <script>
        let categories = [];
        let productCounter = 1; // Counter for unique product IDs
        let categoryCounter = 1; // Counter for unique category IDs

        function addCategory() {
            const categoryName = document.getElementById('categoryName').value.trim();
            if (categoryName) {
                categories.push(categoryName);
                updateCategories();
                document.getElementById('categoryName').value = ''; // Clear input
            } else {
                alert("Introduceți un nume valid pentru categorie.");
            }
        }

        function updateCategories() {
            const categoriesContainer = document.getElementById('categoriesContainer');
            categoriesContainer.innerHTML = ''; // Clear previous categories

            categories.forEach((category, index) => {
                const categoryButton = document.createElement('button');
                categoryButton.textContent = category;
                categoryButton.className = 'categoryButton';
                categoryButton.onclick = () => selectCategory(category, index);
                categoriesContainer.appendChild(categoryButton);
            });
        }

        function selectCategory(category, index) {
            document.getElementById('selectedCategory').textContent = category;
            document.getElementById('itemFormContainer').style.display = 'block';
            document.getElementById('id').value = `${categoryCounter}-${productCounter}`; // Set unique ID based on category and product counter
            productCounter++; // Increment product counter
        }

        function saveProduct() {
            const id = document.getElementById('id').value;
            const name = document.getElementById('name').value;
            const price = document.getElementById('price').value;
            const images = document.getElementById('images').value.split(',').map(img => img.trim());
            const category = document.getElementById('selectedCategory').textContent;
            const description = document.getElementById('description').value;

            // Get optional fields
            const isTrending = document.getElementById('isTrending').checked;
            const old_price = document.getElementById('old_price').value || null; // Allow empty
            const out_Of_stock = document.getElementById('out_Of_stock').checked;
            const isNew = document.getElementById('isNew').checked;
            const product_sizes = document.getElementById('product_sizes').value.split(',').map(size => size.trim()).filter(size => size !== '');

            const product = {
                id: id,
                name: name,
                price: price,
                images: images,
                category: category,
                description: description,
                isTrending: isTrending,
                old_price: old_price,
                out_Of_stock: out_Of_stock,
                isNew: isNew,
                product_sizes: product_sizes.length > 0 ? product_sizes : null // Allow empty array
            };

            fetch('save_product.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(product)
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                resetProductForm(); // Reset form after saving
            })
            .catch(error => console.error('Eroare:', error));
        }

        function resetProductForm() {
            document.getElementById('productForm').reset(); // Reset all form fields
            document.getElementById('itemFormContainer').style.display = 'none'; // Hide the product form
        }
    </script>
</body>
</html>